name: Release

on:
  push:
    branches:
      - master
    # tags:
    #   - "v*.*.*" # Triggers on tags like v1.0.0

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.24'

    - name: Build and package
      run: |
        # Optional: Uncomment to build for multiple platforms (see comments below)

        # Single-platform build (current OS/arch)
        make SYSTRAY=true build

    - name: debug env
      run: echo ${env.ACTIONS_RESULTS_URL}

    - name: Upload release assets
      uses: https://gitea.com/actions/upload-artifact@v4
      with:
        name: release-assets
        path: dist/*

    - name: Create GitHub Release
      uses: actions/create-release@v1
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        body: |
          Automated release from CI
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    # # Cross-platform build (uncomment to use):
    # - name: Cross-platform builds
    #   strategy:
    #     matrix:
    #       goos: [linux, windows, darwin]
    #       goarch: [amd64, 386, arm64]
    #   runs-on: ubuntu-latest
    #   steps:
    #     - name: Set GOOS/GOARCH
    #       run: |
    #         echo "GOOS=${{ matrix.goos }}" >> $GITHUB_ENV
    #         echo "GOARCH=${{ matrix.goarch }}" >> $GITHUB_ENV
    #     - name: Build
    #       run: make release
    #     - name: Package
    #       run: make dist
    #     - name: Upload artifact
    #       uses: actions/upload-artifact@v4
    #       with:
    #         name: release-assets-${{ matrix.goos }}-${{ matrix.goarch }}
    #         path: dist/*.tar.gz
